name: Jit Scan

on:
  workflow_dispatch:

jobs:
  Jit-Security-Scan:
    runs-on: ubuntu-latest
    permissions: write-all

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Set up Maven
        uses: stCarolas/setup-maven@v5
        with:
          maven-version: 3.8.2

      - name: Build Java Project
        run: mvn clean install -DskipTests

      # ============================
      # Jit Integration Starts Here
      # ============================
      - name: Install Jit CLI
        run: |
          curl -s https://raw.githubusercontent.com/jitsecurity-dev/jit-cli/main/install.sh | bash
          echo "$HOME/.jit/bin" >> $GITHUB_PATH

      - name: Initialize Jit Project (if needed)
        run: |
          jit init --ci --no-input || echo "Already initialized"

      - name: Run Jit Scan
        run: |
          jit scan run --ci --project .

      # ============================
      # Optional Summary (basic)
      # ============================
      - name: Print Jit Scan Summary
        run: |
          echo "## 🔍 Jit Scan Completed" >> $GITHUB_STEP_SUMMARY
          echo "See full scan results in the Actions logs above."
